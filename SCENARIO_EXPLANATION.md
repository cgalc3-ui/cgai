# ๐ฑ ุดุฑุญ ุณููุงุฑูู ุงููุตุงุฏูุฉ ุนุจุฑ ุงููุงุชู ู SMS

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุงููุธุงู ูุนูู ุจุฏูู ูููุงุช ูุฑูุฑ! ุงููุณุชุฎุฏู ูุณุฌู ููุฏุฎู ููุท ุจุฑูู ุงููุงุชู ูููุฏ ุงูุชุญูู ุงููุฑุณู ุนุจุฑ SMS.

---

## ๐ ุงูุณููุงุฑูู ุงููุงูู

### ๐ต ุงูุณููุงุฑูู 1: ุงูุชุณุฌูู (Registration)

#### ุงูุฎุทูุฉ 1: ุงููุณุชุฎุฏู ูุทูุจ ููุฏ ุงูุชุญูู
```
POST /api/send-verification-code
Body: {
  "phone": "0501234567",
  "type": "registration"
}
```

**ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:**
1. โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (phone ูุทููุจ)
2. โ ุงูุชุญูู ูู ุฃู ุงูุฑูู ุบูุฑ ูุณุฌู ูุณุจูุงู
3. โ ุฅูุดุงุก ููุฏ ุชุญูู ุนุดูุงุฆู (6 ุฃุฑูุงู)
4. โ ุญูุธ ุงูููุฏ ูู ุฌุฏูู `verification_codes` ูุน:
   - ุฑูู ุงููุงุชู
   - ุงูููุฏ
   - ููุน ุงูุนูููุฉ (registration)
   - ุชุงุฑูุฎ ุงูุชูุงุก ุงูุตูุงุญูุฉ (ุจุนุฏ 10 ุฏูุงุฆู)
   - ุนุฏุฏ ุงููุญุงููุงุช = 0
5. โ ุฅุฑุณุงู SMS ุนุจุฑ ููุฑุฌูุงูู:
   - ุชูุณูู ุฑูู ุงููุงุชู (05XXXXXXXX โ 9665XXXXXXXX)
   - ุงูุชุญูู ูู Rate Limiting
   - ุฅุฑุณุงู ุงูุฑุณุงูุฉ: "ููุฏ ุงูุชุญูู ุงูุฎุงุต ุจู ูู: 123456"
   - ุชุณุฌูู ุงูุนูููุฉ ูู `sms_logs`
6. โ ุฅุฑุฌุงุน ุฑุณุงูุฉ ูุฌุงุญ

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุฅุฑุณุงู ููุฏ ุงูุชุญูู ุจูุฌุงุญ",
  "expires_in": 10
}
```

---

#### ุงูุฎุทูุฉ 2: ุงููุณุชุฎุฏู ูุฏุฎู ุงูููุฏ ููุณุฌู
```
POST /api/register
Body: {
  "name": "ุฃุญูุฏ ูุญูุฏ",
  "phone": "0501234567",
  "code": "123456"
}
```

**ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:**
1. โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช (name, phone, code)
2. โ ุงูุชุญูู ูู ุงูููุฏ:
   - ุงูุจุญุซ ุนู ููุฏ ุบูุฑ ูุณุชุฎุฏู
   - ุงูุชุญูู ูู ุฃู ุงูููุฏ ูู ููุชูู (ุฃูู ูู 10 ุฏูุงุฆู)
   - ุงูุชุญูู ูู ุฃู ุนุฏุฏ ุงููุญุงููุงุช ุฃูู ูู 5
   - ููุงุฑูุฉ ุงูููุฏ ุงููุฏุฎู ุจุงูููุฏ ุงููุญููุธ
   - ุฅุฐุง ุตุญูุญ: ุชุญุฏูุซ `verified = true` ู `verified_at`
   - ุฅุฐุง ุฎุทุฃ: ุฒูุงุฏุฉ `attempts` ุจููุฏุงุฑ 1
3. โ ุงูุชุญูู ูู ุฃู ุงูุฑูู ุบูุฑ ูุณุฌู ูุณุจูุงู
4. โ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ:
   - ุญูุธ ุงูุงุณู
   - ุญูุธ ุฑูู ุงููุงุชู
   - ุชุนููู `phone_verified_at = now()`
   - ุฅูุดุงุก ูููุฉ ูุฑูุฑ ุนุดูุงุฆูุฉ (ูุฃููุง ูุง ูุณุชุฎุฏููุง)
5. โ ุฅูุดุงุก Token ูููุตุงุฏูุฉ (Laravel Sanctum)
6. โ ุฅุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ูุงูู Token

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุงูุชุณุฌูู ุจูุฌุงุญ",
  "user": {
    "id": 1,
    "name": "ุฃุญูุฏ ูุญูุฏ",
    "phone": "0501234567",
    "phone_verified_at": "2025-12-23T12:00:00.000000Z"
  },
  "token": "1|xxxxxxxxxxxxxxxxxxxxx"
}
```

---

### ๐ข ุงูุณููุงุฑูู 2: ุชุณุฌูู ุงูุฏุฎูู (Login)

#### ุงูุฎุทูุฉ 1: ุงููุณุชุฎุฏู ูุทูุจ ููุฏ ุงูุชุญูู
```
POST /api/send-verification-code
Body: {
  "phone": "0501234567",
  "type": "login"
}
```

**ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:**
1. โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
2. โ ุงูุชุญูู ูู ุฃู ุงูุฑูู ูุณุฌู ูุณุจูุงู (ูุฃูู login)
3. โ ุฅูุดุงุก ููุฏ ุชุญูู ุฌุฏูุฏ
4. โ ุฅุฑุณุงู SMS ุจุงูููุฏ
5. โ ุฅุฑุฌุงุน ุฑุณุงูุฉ ูุฌุงุญ

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุฅุฑุณุงู ููุฏ ุงูุชุญูู ุจูุฌุงุญ",
  "expires_in": 10
}
```

---

#### ุงูุฎุทูุฉ 2: ุงููุณุชุฎุฏู ูุฏุฎู ุงูููุฏ ููุณุฌู ุงูุฏุฎูู
```
POST /api/login
Body: {
  "phone": "0501234567",
  "code": "123456"
}
```

**ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:**
1. โ ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
2. โ ุงูุชุญูู ูู ุงูููุฏ (ููุณ ุฎุทูุงุช ุงูุชุณุฌูู)
3. โ ุงูุจุญุซ ุนู ุงููุณุชุฎุฏู ุจุฑูู ุงููุงุชู
4. โ ุชุญุฏูุซ `phone_verified_at = now()`
5. โ ุฅูุดุงุก Token ุฌุฏูุฏ ูููุตุงุฏูุฉ
6. โ ุฅุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู ูุงูู Token

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ",
  "user": {
    "id": 1,
    "name": "ุฃุญูุฏ ูุญูุฏ",
    "phone": "0501234567"
  },
  "token": "2|yyyyyyyyyyyyyyyyyyyyy"
}
```

---

### ๐ด ุงูุณููุงุฑูู 3: ุงุณุชุฎุฏุงู ุงูู Token (Protected Routes)

#### ุงูุญุตูู ุนูู ุจูุงูุงุช ุงููุณุชุฎุฏู
```
GET /api/user
Headers: {
  "Authorization": "Bearer 2|yyyyyyyyyyyyyyyyyyyyy"
}
```

**ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:**
1. โ Laravel Sanctum ูุชุญูู ูู ุงูู Token
2. โ ุฅุฐุง ุตุญูุญ: ุฅุฑุฌุงุน ุจูุงูุงุช ุงููุณุชุฎุฏู
3. โ ุฅุฐุง ุฎุทุฃ: ุฅุฑุฌุงุน 401 Unauthorized

**Response:**
```json
{
  "success": true,
  "user": {
    "id": 1,
    "name": "ุฃุญูุฏ ูุญูุฏ",
    "phone": "0501234567"
  }
}
```

---

#### ุชุณุฌูู ุงูุฎุฑูุฌ
```
POST /api/logout
Headers: {
  "Authorization": "Bearer 2|yyyyyyyyyyyyyyyyyyyyy"
}
```

**ูุง ูุญุฏุซ ูู ุงูุฎูููุฉ:**
1. โ Laravel Sanctum ูุชุญูู ูู ุงูู Token
2. โ ุญุฐู ุงูู Token ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. โ ุงููุณุชุฎุฏู ูู ูุนุฏ ูุงุฏุฑุงู ุนูู ุงุณุชุฎุฏุงู ูุฐุง ุงูู Token

**Response:**
```json
{
  "success": true,
  "message": "ุชู ุชุณุฌูู ุงูุฎุฑูุฌ ุจูุฌุงุญ"
}
```

---

## ๐ ุงูุญูุงูุฉ ูุงูุฃูุงู

### 1. Rate Limiting (ุญุฏ ูุนุฏู ุงูุฅุฑุณุงู)
- **5 ุฑุณุงุฆู ูู ุงูุฏูููุฉ** ููู ุฑูู ูุงุชู
- **20 ุฑุณุงูุฉ ูู ุงูุณุงุนุฉ** ููู ุฑูู ูุงุชู
- **100 ุฑุณุงูุฉ ูู ุงูููู** ููู ุฑูู ูุงุชู

### 2. ููุฏ ุงูุชุญูู
- **6 ุฃุฑูุงู** ุนุดูุงุฆูุฉ
- **ุตุงูุญ ููุฏุฉ 10 ุฏูุงุฆู** ููุท
- **ุญุฏ ุฃูุตู 5 ูุญุงููุงุช** ููุชุญูู
- ุจุนุฏ 5 ูุญุงููุงุช ุฎุงุทุฆุฉุ ุงูููุฏ ูุตุจุญ ุบูุฑ ุตุงูุญ

### 3. ุชูุณูู ุฃุฑูุงู ุงูููุงุชู
ุงููุธุงู ูุฏุนู ุงูุตูุบ ุงูุชุงููุฉ:
- `5XXXXXXXX` โ `9665XXXXXXXX`
- `05XXXXXXXX` โ `9665XXXXXXXX`
- `9665XXXXXXXX` โ `9665XXXXXXXX`

### 4. ุชุณุฌูู ุฌููุน ุงูุนูููุงุช
- ูู ุฑุณุงูุฉ SMS ุชูุณุฌู ูู `sms_logs`
- ูู ููุฏ ุชุญูู ููุณุฌู ูู `verification_codes`
- ูููู ุชุชุจุน ุฌููุน ุงูุนูููุงุช

---

## ๐ ูุซุงู ุนููู ูุงูู

### ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ "ุฃุญูุฏ" ูุฑูุฏ ุงูุชุณุฌูู:

**1. ููุชุญ ุงูุชุทุจูู ููุฏุฎู ุฑููู:**
```
POST /api/send-verification-code
{
  "phone": "0501234567",
  "type": "registration"
}
```
โ ูุณุชูู SMS: "ููุฏ ุงูุชุญูู ุงูุฎุงุต ุจู ูู: 456789"

**2. ูุฏุฎู ุงูููุฏ ูุงุณูู:**
```
POST /api/register
{
  "name": "ุฃุญูุฏ ูุญูุฏ",
  "phone": "0501234567",
  "code": "456789"
}
```
โ โ ุชู ุงูุชุณุฌูู! ูุญุตู ุนูู Token

**3. ูุณุชุฎุฏู ุงูุชุทุจูู:**
```
GET /api/user
Headers: Authorization: Bearer {token}
```
โ โ ูุญุตู ุนูู ุจูุงูุงุชู

---

### ุงููุณุชุฎุฏู "ุฃุญูุฏ" ูุฑูุฏ ุชุณุฌูู ุงูุฏุฎูู ูุงุญูุงู:

**1. ููุชุญ ุงูุชุทุจูู ููุฏุฎู ุฑููู:**
```
POST /api/send-verification-code
{
  "phone": "0501234567",
  "type": "login"
}
```
โ ูุณุชูู SMS: "ููุฏ ุงูุชุญูู ุงูุฎุงุต ุจู ูู: 789123"

**2. ูุฏุฎู ุงูููุฏ:**
```
POST /api/login
{
  "phone": "0501234567",
  "code": "789123"
}
```
โ โ ุชู ุชุณุฌูู ุงูุฏุฎูู! ูุญุตู ุนูู Token ุฌุฏูุฏ

---

## โ๏ธ ุญุงูุงุช ุงูุฎุทุฃ ุงููุญุชููุฉ

### 1. ููุฏ ุฎุงุทุฆ
```json
{
  "success": false,
  "message": "ููุฏ ุงูุชุญูู ุบูุฑ ุตุญูุญ ุฃู ููุชูู ุงูุตูุงุญูุฉ"
}
```

### 2. ููุฏ ููุชูู ุงูุตูุงุญูุฉ
- ุจุนุฏ 10 ุฏูุงุฆูุ ุงูููุฏ ูุตุจุญ ุบูุฑ ุตุงูุญ
- ูุฌุจ ุทูุจ ููุฏ ุฌุฏูุฏ

### 3. ุชุฌุงูุฒ ุนุฏุฏ ุงููุญุงููุงุช
- ุจุนุฏ 5 ูุญุงููุงุช ุฎุงุทุฆุฉุ ุงูููุฏ ูุตุจุญ ุบูุฑ ุตุงูุญ
- ูุฌุจ ุทูุจ ููุฏ ุฌุฏูุฏ

### 4. Rate Limit
```json
{
  "success": false,
  "message": "Rate limit exceeded"
}
```
- ูุฌุจ ุงูุงูุชุธุงุฑ ูุจู ุทูุจ ููุฏ ุฌุฏูุฏ

### 5. ุฑูู ูุณุฌู ูุณุจูุงู (ูู ุงูุชุณุฌูู)
```json
{
  "success": false,
  "message": "ุฑูู ุงููุงุชู ูุณุฌู ุจุงููุนู"
}
```

### 6. ุฑูู ุบูุฑ ูุณุฌู (ูู ุชุณุฌูู ุงูุฏุฎูู)
```json
{
  "success": false,
  "message": "ุฑูู ุงููุงุชู ุบูุฑ ูุณุฌู"
}
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุงููุธุงู ุจุณูุท ูุขูู:
1. **ุจุฏูู ูููุงุช ูุฑูุฑ** - ููุท ุฑูู ูุงุชู ูููุฏ SMS
2. **ุขูู** - Rate Limiting + ุฃููุงุฏ ููุชููุฉ ุงูุตูุงุญูุฉ
3. **ุณูู ุงูุงุณุชุฎุฏุงู** - ุฎุทูุชูู ููุท (ุทูุจ ููุฏ + ุฅุฏุฎุงู ููุฏ)
4. **ูุงุจู ููุชุชุจุน** - ูู ุดูุก ูุณุฌู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

